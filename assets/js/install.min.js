jQuery(document).ready(function(a){function b(b){this.step=b,this.total_posts=0,this.ppr=null,this.action=null,this.percentage_object=null,this.nonce=null,this.do_request=function(){var b=this;a.post(ajaxurl,{action:this.action,nonce:a("#rp4wp-ajax-nonce").val(),ppr:this.ppr,rel_amount:a("#rp4wp_related_posts_amount").val()},function(a){var c=new RegExp("^[0-9]+$");if(a=a.trim(),c.test(a)){var d=parseInt(a);b.do_progressbar(d),d>0?b.do_request():b.done()}else alert("Woops! Something went wrong while linking.\n\nResponse:\n\n"+a)})},this.done=function(){a("#progressbar").progressbar({value:100}),window.location=a("#rp4wp_admin_url").val()+"?page=rp4wp_install&rp4wp_nonce="+this.nonce+"&step="+(this.step+1)},this.do_progressbar=function(b){var c=this.total_posts-b;c<0&&(c=0),jQuery("#progress-done").html(c),jQuery("#progress-todo").html(b);var d=Math.round(c/this.total_posts*100);d>0&&(this.percentage_object.html(d+"%"),a("#progressbar").progressbar({value:d}))},this.init=function(){switch(a("#progressbar").progressbar({value:!1}),this.percentage_object=jQuery("<span>"),a("#progressbar").find("div:first").append(this.percentage_object),this.do_progressbar(a("#rp4wp_posts_todo").val()),this.total_posts=a("#rp4wp_total_posts").val(),this.nonce=a("#rp4wp_nonce").val(),this.step){case 1:this.ppr=25,this.action="rp4wp_install_save_words";break;case 2:this.ppr=5,this.action="rp4wp_install_link_posts"}jQuery("#progress-container").show(),this.do_request()},this.init()}var c=a(".rp4wp-step").attr("rel");1==c?b(1):2==c&&a("#rp4wp-link-now").click(function(){b(2)})});